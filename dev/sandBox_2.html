<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title></title>
  <script type="text/javascript" src="/IM/defSandBox.php"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  
<!--    以下は新居さんがアドバイスしてくれたScript-->
    <script type="text/javascript">
        INTERMediatorOnPage.doBeforeConstruct = function() {
        INTERMediator.navigationLabel = ["最初へ", null, null, "最後へ", null, null, null, null, false];
        }
        INTERMediatorOnPage.doAfterConstruct = function () {
        if (!INTERMediator.partialConstructing) {
            var context = IMLibContextPool.contextFromName('atmos_list');
            var keys = Object.keys(context.store);
            var buttonId = context.store[keys[0]]['_im_button_master_id'];
            document.getElementById(buttonId).click();
        }
    }
   
    //プログラム更新時にgit リポジトリから最新版をインストールするボタンを追加
    $(function() {
        var $updateInputs = $("#update-data-form").find("input");
        
        $updateInputs.on("click", function() {
            var result = confirm( "サーバー側のプログラムをアップデートしますか？" );
                if(result){
                    var $this = $(this); 
                    $.ajax({
                    type: "POST",
                    url: "gitPull.php",
                    data: {
                        id: $this.attr("id")
                    },
                    success: function(html) {
                        alert(html);
                        $this.val("更新完了");
                        location.reload();
                    },
                    error: function(html){
                        alert(html);
                        $this.val("更新失敗 !!!");
                    }
                    })
                    
                }else{
                    console.log(" CANCEL が押された");
                }
            
       });
    });
        </script>
</head>
<body>
<input type="text" data-im="_@condition:atmos_list:date:*match*">
  <button data-im="_@update:atmos_list@">検索</button>
  レコード数：<select data-im="_@limitnumber:atmos_list">
  <option value="5" selected="selected">5</option>
  <option value="10">10</option>
  <option value="20">20</option>
  </select>
<a href="https://ambidata.io/ch/channel.html?id=999">グラフ表示</a>
<a href="http://mochimugi.sakura.ne.jp/seasonShots/index_sandBox.html">ホームページ</a>

<form style ="position: absolute; right: 0px; top: 0px" id="update-data-form">
    <input type="button" value="アップデート" id="gitPull" />
</form>
    
	<div id="IM_NAVIGATOR"></div>
    <table style="float: left; margin-right:20px;">
        <thead>
            <tr><th></th>
                <th>日付<br>
                <span style="cursor: pointer" data-im="_@addorder:atmos_list@:date:asc">［昇順］</span>
                <span style="cursor: pointer" data-im="_@addorder:atmos_list@:date:desc">［降順］</span></th>
                <th>温度（℃）</th><th>気圧（hPa）</th><th>湿度（%）</th><th>明るさ lux<br>（5000以下は曇り）</th><th>外気温</th></tr>
        </thead>
        <tbody>
            <tr style="text-align:right">
                <td></td><!--詳細ボタン表示用のエリアを用意しておく-->
				<td data-im="atmos_list@date"></td>
				<td data-im="atmos_list@temp atmos_list@color_temp@style.color"></td>
				<td data-im="atmos_list@pressure"></td>
				<td data-im="atmos_list@humid"></td>
				<td data-im="atmos_list@lux atmos_list@color_lux@style.color"></td>
                <td data-im="atmos_list@outer_temp"></td>
            </tr>
        </tbody>
    </table>
    <table>
            <tr><th>id</th>
                <td width="50%" data-im="atmos_detail@id"></td>
                <th>CPU温度</th>
                <td width="50%" data-im="atmos_detail@cpu_temp"></td>
            </tr>
            
            <tr><th>date</th>
                <td data-im="atmos_detail@date"></td>
                <th>外気温</th>
                <td data-im="atmos_detail@outer_temp"></td>
            </tr>
            <tr><th>接続間隔</th>
                <td data-im="atmos_detail@diff_time"></td>
                <th>外気圧</th>
                <td data-im="atmos_detail@outer_pressure"></td>
            </tr>
            <tr><th>ケース内温度</th>
                <td data-im="atmos_detail@temp"></td>
                <th>外湿度</th>
                <td data-im="atmos_detail@outer_humid"></td>
            </tr>
            <tr><th>気圧</th>
                <td data-im="atmos_detail@pressure"></td>
                <th>太陽光発電電圧</th>
                <td data-im="atmos_detail@v0"></td>
            </tr>
            <tr><th>湿度</th>
                <td data-im="atmos_detail@humid"></td>
                <th>バッテリー電圧</th>
                <td data-im="atmos_detail@v1"></td>
            </tr>
            <tr><th>照度</th>
                <td data-im="atmos_detail@lux"></td>
            </tr>            

            <tr><th>log</th>
                <td colspan="2"> <textarea cols ="100%" rows="20" data-im="atmos_detail@log"></textarea></td>
<!--                <td> <textarea cols ="100%" rows="20" data-im="atmos_detail@log"></textarea></td> -->
            </tr>    
    </table>



    <br clear="all/">
</body>
</html>
